# public-api-tools

Tools for working with the Confident Cannabis API.

Each language has a folder of examples and helpful modules within it. Check
out the readme.md at the top of each language folder for specific information
about how to get set up and run the tests.


## Request Signing

The public API requires generating signatures for each request using
an api key and api secret for authentication. Consult the api docs
directly for the most up to date instructions, but these packages
provide working examples of how to correctly sign requests.

Integrate them into your own projects and test against the signing test
endpoint on the API version you are integrating.

Here are a couple examples:

Python:
```python
from .signing import generate_signature

method = 'GET'
route = '/api/v0/signingtest/'
headers = {'X-ConfidentCannabis-Timestamp': '1474507118.77095'}
data = {'foo': 1, 'bar': 2}
api_key = '88b750a8-d414-4aee-b26c-2cc7e85434dd'
api_secret = '043bca27-c4d1-4d39-86d6-e5f0c3b4bb4f'

signature = generate_signature(method, route, headers, data, api_key, api_secret)
print(signature)

>>> 'CC0-HMAC-SHA256:x-confidentcannabis-timestamp:f4f830ac634dee9a9c98bfe71427d4b7e78ffd0356ee305958bc3687d40ffa43'  # NOQA
```

Javascript:
```js
// NOTE! the percent encoding required by the api is different than that
// returned by the encodeURIComponent function. Please look at the source.
var generateSignature = require('.signing').generateSignature;

method = 'GET'
route = '/api/v0/signingtest/'
headers = {'X-ConfidentCannabis-Timestamp': '1474507118.77095'}
data = {'foo': 1, 'bar': 2}
api_key = '88b750a8-d414-4aee-b26c-2cc7e85434dd'
api_secret = '043bca27-c4d1-4d39-86d6-e5f0c3b4bb4f'

var signature = generateSignature(method, route, headers, data, apiKey, apiSecret);
console.log(signature);

> 'CC0-HMAC-SHA256:x-confidentcannabis-timestamp:f4f830ac634dee9a9c98bfe71427d4b7e78ffd0356ee305958bc3687d40ffa43'
```


## Special Encoding

Inevitably, each language and encoding library handles percent encoding
differently. The Confident Cannabis API is currently using a combination of
python's stdlib urllib.escape_plus and urllib.urlencode, which results in
nearly every character being percent encoded except notably space, which
becomes a + sign.

Below is a table showing all the standard ascii printable characters
encoded the way the api is expecting. This is the output generated by
the sample signing libraries included in this repository and is generated
by running `python generate_side_by_side_encodings.py`, which includes
content generated from the signing libraries using the export_signing_for_debug
functions included in the code.

| Source | Python | JS  |
|--------|--------|-----|
|   0    |    0   | 0   |
|   1    |    1   | 1   |
|   2    |    2   | 2   |
|   3    |    3   | 3   |
|   4    |    4   | 4   |
|   5    |    5   | 5   |
|   6    |    6   | 6   |
|   7    |    7   | 7   |
|   8    |    8   | 8   |
|   9    |    9   | 9   |
|   a    |    a   | a   |
|   b    |    b   | b   |
|   c    |    c   | c   |
|   d    |    d   | d   |
|   e    |    e   | e   |
|   f    |    f   | f   |
|   g    |    g   | g   |
|   h    |    h   | h   |
|   i    |    i   | i   |
|   j    |    j   | j   |
|   k    |    k   | k   |
|   l    |    l   | l   |
|   m    |    m   | m   |
|   n    |    n   | n   |
|   o    |    o   | o   |
|   p    |    p   | p   |
|   q    |    q   | q   |
|   r    |    r   | r   |
|   s    |    s   | s   |
|   t    |    t   | t   |
|   u    |    u   | u   |
|   v    |    v   | v   |
|   w    |    w   | w   |
|   x    |    x   | x   |
|   y    |    y   | y   |
|   z    |    z   | z   |
|   A    |    A   | A   |
|   B    |    B   | B   |
|   C    |    C   | C   |
|   D    |    D   | D   |
|   E    |    E   | E   |
|   F    |    F   | F   |
|   G    |    G   | G   |
|   H    |    H   | H   |
|   I    |    I   | I   |
|   J    |    J   | J   |
|   K    |    K   | K   |
|   L    |    L   | L   |
|   M    |    M   | M   |
|   N    |    N   | N   |
|   O    |    O   | O   |
|   P    |    P   | P   |
|   Q    |    Q   | Q   |
|   R    |    R   | R   |
|   S    |    S   | S   |
|   T    |    T   | T   |
|   U    |    U   | U   |
|   V    |    V   | V   |
|   W    |    W   | W   |
|   X    |    X   | X   |
|   Y    |    Y   | Y   |
|   Z    |    Z   | Z   |
|   !    |    %21 | %21 |
|   "    |    %22 | %22 |
|   #    |    %23 | %23 |
|   $    |    %24 | %24 |
|   %    |    %25 | %25 |
|   &    |    %26 | %26 |
|   '    |    %27 | %27 |
|   (    |    %28 | %28 |
|   )    |    %29 | %29 |
|   *    |    %2A | %2A |
|   +    |    %2B | %2B |
|   ,    |    %2C | %2C |
|   -    |    -   | -   |
|   .    |    .   | .   |
|   /    |    %2F | %2F |
|   :    |    %3A | %3A |
|   ;    |    %3B | %3B |
|   <    |    %3C | %3C |
|   =    |    %3D | %3D |
|   >    |    %3E | %3E |
|   ?    |    %3F | %3F |
|   @    |    %40 | %40 |
|   [    |    %5B | %5B |
|   \    |    %5C | %5C |
|   ]    |    %5D | %5D |
|   ^    |    %5E | %5E |
|   _    |    _   | _   |
|   `    |    %60 | %60 |
|   {    |    %7B | %7B |
|   |    |    %7C | %7C |
|   }    |    %7D | %7D |
|   ~    |    %7E | %7E |
|        |    +   | +   |
|   \t   |    %09 | %09 |
|   \n   |    %0A | %0A |
|   \r   |    %0D | %0D |
|   \x0b |    %0B | %0B |
|   \x0c |    %0C | %0C |
